<html lang="en">

<style>
    #result {
        border-style: solid;
        border-color: #949497;
        margin: 10px;
        padding: 10px;
        overflow: auto;
    }

    #content {
        overflow: auto;
    }

    #poster {
        float: right;
    }

    /* Pseudo element */
    div::first-line {
        font-weight: bold;
    }
</style>


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒì¸ë“œì–´ë¬´ë¹„</title>
    <link rel="stylesheet" href="mycss.css">
</head>

<header>
    <a href="main.html" id="site_title">íŒŒì¸ë“œ ì–´ ë¬´ë¹„</a>
</header>

<script>
    function search() {
        if (my_form.txt.value == "") {
            alert("ì˜í™” ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”");
            my_form.txt.focus();
        }
        else {
            var search = my_form.txt.value;

            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;
            xhr.addEventListener("readystatechange", function () {
                if (this.readyState == 4) {
                    // responseText : ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ ê²°ê³¼ í…ìŠ¤íŠ¸ ì „ì²´
                    // console.log(this.responseText);
                    //responseTextë¥¼ ì»¨íŠ¸ë¡¤í•´ì„œ ì›í•˜ëŠ” ë°ì´í„°ë§Œì„ ì¶œë ¥í•˜ì
                    // var result = this.responseText;
                    var myJson = JSON.parse(this.response);
                    // document.getElementById("demo").innerHTML = myJson.Data[0].Result[0].plots.plot[0].plotText;
                    if (myJson.TotalCount == "0") {
                        document.getElementById("demo").innerHTML = search + " ê²€ìƒ‰ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."
                    }
                    else {
                        var str = ""
                        for (var i = 0; i < parseInt(myJson.TotalCount); i++) {
                            var title = myJson.Data[0].Result[i].title;
                            title = title.replace(/\!HS/g, " ");
                            title = title.replace(/\!HE/g, " ")
                            title = title.replace(/^\s+|\s+$/g, "");
                            title = title.replace(/ +/g, " ");

                            var date = "ê°œë´‰ : " + myJson.Data[0].Result[i].repRlsDate;
                            var grade = "ë“±ê¸‰ : " + myJson.Data[0].Result[i].ratings.rating[0].ratingGrade
                            var genre = "ê°œìš” : " + myJson.Data[0].Result[i].genre;
                            var plot = "ì†Œê°œ : " + myJson.Data[0].Result[i].plots.plot[0].plotText;
                            var director = "ê°ë… : " + myJson.Data[0].Result[i].directors.director[0].directorNm;

                            var actor = ""
                            for (var j = 0; j < myJson.Data[0].Result[i].actors.actor.length - 1; j++) {
                                actor = actor + myJson.Data[0].Result[i].actors.actor[j].actorNm + ", ";
                            }
                            actor = actor + myJson.Data[0].Result[i].actors.actor[myJson.Data[0].Result[i].actors.actor.length - 1].actorNm;
                            actor = "ì¶œì—° : " + actor;

                            var poster = myJson.Data[0].Result[i].posters;
                            var image = ""
                            for (var k = 0; k < poster.length; k++) {
                                if (poster[k] == "|") {
                                    break;
                                }
                                else {
                                    image = image + poster[k]
                                }
                            }
                            str = str + '<div id = "result"><div id = poster><img src =" ' + image + '"></div><div id = "content"><p>' + title + '<br>' + grade + '<br>'
                                + date + '<br>' + genre + '<br>' + plot + '<br>' + director + '<br>' + actor + '<br>' + '</p></div></div>';

                        }
                        document.getElementById("demo").innerHTML = str;
                    }
                }
            });
            //("GET" ë°©ì‹, ìš”ì²­ë³´ë‚´ëŠ” URL)
            // document.getElementsByClassName("my_footer")[0].style.position = "relative";
            xhr.open("GET", "http://localhost:3000/api?word=" + encodeURI(search));
            xhr.send();
        }
    }

</script>

<body>
    <div id="whole">
        <div id="navigator">
            <nav>
                <ul>
                    <li><a href="main.html">ğŸ Home</a></li>
                    <li><a href="movie.html">ğŸ¥ì˜í™” ê²€ìƒ‰</a></li>
                    <li><a href="review.html">ğŸ‘ì˜í™” ë¦¬ë·° ê²€ìƒ‰</a></li>
                    <li><a href="theater.html">ğŸï¸ì˜í™”ê´€ ê²€ìƒ‰</a></li>
                </ul>
            </nav>
        </div>

        <div id="main">

            <form name="my_form">
                <div id="movie">
                    <!-- <h1 id = main_title>ì„œì¹˜ ì–´ ë¬´ë¹„</h1> -->
                    <div id='search_box'>
                        <table width=80% align="center" border="0">
                            <tr>
                                <td>
                                    <input type="text" name="txt" id="search_txt" placeholder="ì˜í™”ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                                </td>
                                <td>
                                    <input type="button" id="search_button" value="ğŸ”" onclick="search()">
                                </td>
                            </tr>
                        </table>
                        <!-- <input type="text" name="txt" id="search_txt" placeholder="ì˜í™”ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                        <input type="button" id="search_button" value="ğŸ”" onclick="search()"> -->
                        <!-- <button id="search_button" onclick="search()"></button> -->
                    </div>
                </div>
                <div id="search_result"></div>
            </form>
        </div>
        <p id="demo"></p>

        <footer class="my_footer">
            <ul>
                <li>ğŸ§‘ğŸ»â€ğŸ’»Developed by : YunJae LEE (PNU CSE)</li>
                <li>âœ‰ï¸Contact me : gooneryj1917@pusan.ac.kr</li>
            </ul>
        </footer>
    </div>

</body>



</html>